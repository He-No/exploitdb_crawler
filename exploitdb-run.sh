#!/bin/bash

# declare files
data="./data.txt"
report="./report.txt"
report_backup="./report.backup"
alert="./attention.log"

echo ""
echo "removing old database.."

if [ -d /opt/exploit-database/ ]
then
	rm -rf /opt/exploit-database/
fi

if [ -f ~/.searchsploit_rc ]
then
	rm -f ~/.searchsploit_rc
fi

echo ""
echo "installing new database.."

git clone https://github.com/offensive-security/exploit-database.git /opt/exploit-database > /dev/null 2>&1
ln -sf /opt/exploit-database/searchsploit /usr/local/bin/searchsploit
cp -n /opt/exploit-database/.searchsploit_rc ~/

mv $report $report_backup

echo "" > $report

echo ""
echo "importing all your applications.."

# read applications from file into array
while IFS= read -r line; do
	applications+=("$line")
done <$data

echo ""
echo "generating report.."

# generate report
len=${#applications[@]}
for ((i=0; i<$len; i++)); do searchsploit -t "${applications[$i]}" >> $report; done

echo ""
echo "Generate report: SUCCES"
echo "Consult report: /opt/exploitdb-crawler/report.txt!"

echo ""
echo "analyzing report.."
diff -q $report $report_backup > alert.txt

echo ""
echo "mailing the report..   (check your inbox!)"
echo ""
if [[ -s alert.txt ]]
then echo "file contains string"
else echo "file is empty"
fi
